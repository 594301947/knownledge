### CPU三级缓存（Cache）

- CPU缓存是什么？
  - 为了解决CPU运行处理速度 >> 内存读写速度的矛盾
  - 我们来简单地打个比方：如果CPU在L1一级缓存中找到所需要的资料要用的时间为3个周期左右，那么在L2二级缓存找到资料的时间就要10个周期左右，L3三级缓存所需时间为50个周期左右；如果要到内存上去找呢，那就慢多了，可能需要几百个周期的时间。

- Cache存在的意义
  - 作为CPU与内存之间高速数据缓冲区
  - L1最靠近CPU核心，运行速度最快
- 原理
  - 局部性原理（最近访问的数据，将大概率被再次访问）

### 两个线程在单核CPU中能同时执行么？

- 不能
  - 我们平时所看到的多线程在单核CPU中并发执行（本质上不是并行执行），看起来是同时执行的，是由于CPU的调度，使得两个线程进行上下文切换，本质上在某个时间刻，只有一个线程在执行

### 既然CPU用一个时间只能执行一个线程，那么why存在并发问题

- 并发问题是由于CPU线程上下文切换导致的
  - CPU切换线程并不会管你的线程是否将代码执行完，而是和分给线程的时间片到期有关
  - 在时间片到期后，会保存线程的上下文，切换到另外一个线程执行
  - 线程A先执行i++，然后由于CPU调度发生线程切换，切换到线程B，线程B在执行i++，此后，切回线程A，但是线程A的i值仍然是当时保存的上下文的值，因此，就出现并发问题

```c++
void thread_func(){
    i++;
}
```

### Volatile 随时可能发生变化的

该关键字，可以防止扁你其对某个变量进行优化，每次去读取变量的值，总是重新从它所处的`内存`中读取（而不去读寄存器）。

- 编译器优化，会导致某个变量的值存入寄存器，当读取数据时，先去读取寄存器的值
- 但是，如果该值已经被修改，寄存器的值却由于优化没有发生改变，就会发生错误呀。